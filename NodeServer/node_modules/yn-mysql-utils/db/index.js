const mysql = require('mysql');
const config = require('../config');
class MySqlDb {
    constructor(Option){
        if(!Option) {
            throw new Error("请传入配置参数");
        }else {
            Option.host = Option.host || config.host
            Option.user = Option.user || config.user
            Option.password = Option.password || config.password
            Option.database = Option.database || config.database
            Option.connectionLimit = Option.connectionLimit || config.connectionLimit
        }

        this.pool = mysql.createPool(Option)
    }
    /**
     * 执行数据库查询
     * @param {*object} params 参数
     * {
     *   sql : 数据库语句
     *   par : 查询参数
     * }
     */
    async Query(params){
        return new Promise(( resolve, reject ) => {
            this.pool.getConnection(function(err, connection) {
                if (err) throw err;
                connection.query(params.sql,params.par, function (error, results, fields) {
                    if (error) reject(error);
                    resolve(results)
                    connection.release();
                });
              });
        })
    }
}

module.exports = MySqlDb;